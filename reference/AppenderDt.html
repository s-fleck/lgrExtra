<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Log to an in-memory data.table — AppenderDt • lgrExtra</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Log to an in-memory data.table — AppenderDt"><meta property="og:description" content="An Appender that outputs to an in-memory data.table. It fulfill a similar
purpose as the more flexible AppenderBuffer and is mainly included for
historical reasons/backwards compatibility with older version of lgr.
NOTE: AppenderDt has been superseded by lgr::AppenderBuffer and is
kept mainly for archival purposes."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lgrExtra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Log to an in-memory data.table</h1>
    
    <div class="hidden name"><code>AppenderDt.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>An Appender that outputs to an in-memory <code>data.table</code>. It fulfill a similar
purpose as the more flexible AppenderBuffer and is mainly included for
historical reasons/backwards compatibility with older version of <strong>lgr</strong>.</p>
<p><strong>NOTE</strong>: AppenderDt has been superseded by <a href="https://s-fleck.github.io/lgr/reference/AppenderBuffer.html" class="external-link">lgr::AppenderBuffer</a> and is
kept mainly for archival purposes.</p>
    </div>


    <div id="value">
    <h2>Value</h2>
    

<p>The <code>$new()</code> method returns an <a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6::R6</a> that inherits from
<a href="https://s-fleck.github.io/lgr/reference/Appender.html" class="external-link">lgr::Appender</a> and can be uses as an appender by a <a href="https://s-fleck.github.io/lgr/reference/Logger.html" class="external-link">lgr::Logger</a>.</p>
    </div>
    <div id="custom-fields">
    <h2>Custom Fields</h2>
    


<p><code>AppenderDt</code> supports custom fields, but they have to be
pre-allocated in the <code>prototype</code> argument. Custom fields that are not
part of the prototype are inserted in the list-column <code>.fields</code> if it
exists.</p>
    </div>
    <div id="creating-a-data-table-appender">
    <h2>Creating a Data Table Appender</h2>
    


<p>In addition to the usual fields, <code>AppenderDt$new()</code> requires that you supply
a <code>buffer_size</code> and a <code>prototype</code>. These determine the structure of the
<code>data.table</code> used to store the log this appender creates and cannot be
modified anymore after the instantiation of the appender.</p>
<p>The <a href="https://s-fleck.github.io/lgr/reference/Layout.html" class="external-link">lgr::Layout</a> for this Appender is used only to format console output of
its <code>$show()</code> method.</p>
    </div>
    <div id="comparison-appenderbuffer-and-appenderdt">
    <h2>Comparison AppenderBuffer and AppenderDt</h2>
    


<p>Both AppenderBuffer and AppenderDt do in memory buffering of events.
AppenderBuffer retains a copies of the events it processes and has the
ability to pass the buffered events on to other Appenders. AppenderDt
converts the events to rows in a <code>data.table</code> and is a bit harder to
configure. Used inside loops (several hundred iterations),
AppenderDt has much less overhead than AppenderBuffer. For single logging
calls and small loops, AppenderBuffer is more performant. This is related to
how memory pre-allocation is handled by the appenders.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></p>
<p>Other Appenders: 
<code><a href="AppenderDbi.html">AppenderDbi</a></code>,
<code><a href="AppenderElasticSearch.html">AppenderElasticSearch</a></code>,
<code><a href="AppenderGmail.html">AppenderGmail</a></code>,
<code><a href="AppenderPushbullet.html">AppenderPushbullet</a></code>,
<code><a href="AppenderSendmail.html">AppenderSendmail</a></code>,
<code><a href="AppenderSyslog.html">AppenderSyslog</a></code></p></div>
    </div>
    <div id="super-classes">
    <h2>Super classes</h2>
    <p><code><a href="https://s-fleck.github.io/lgr/reference/Filterable.html" class="external-link">lgr::Filterable</a></code> -&gt; <code><a href="https://s-fleck.github.io/lgr/reference/Appender.html" class="external-link">lgr::Appender</a></code> -&gt; <code>AppenderDt</code></p>
    </div>
    <div id="methods">
    <h2>Methods</h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-AppenderDt-new"><code>AppenderDt$new()</code></a></p></li>
<li><p><a href="#method-AppenderDt-append"><code>AppenderDt$append()</code></a></p></li>
<li><p><a href="#method-AppenderDt-show"><code>AppenderDt$show()</code></a></p></li>
<li><p><a href="#method-AppenderDt-set_layout"><code>AppenderDt$set_layout()</code></a></p></li>
</ul></div><p><details><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="add_filter"><a href="../../lgr/html/Filterable.html#method-Filterable-add_filter"><code>lgr::Filterable$add_filter()</code></a></span></li>
<li><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="filter"><a href="../../lgr/html/Filterable.html#method-Filterable-filter"><code>lgr::Filterable$filter()</code></a></span></li>
<li><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="remove_filter"><a href="../../lgr/html/Filterable.html#method-Filterable-remove_filter"><code>lgr::Filterable$remove_filter()</code></a></span></li>
<li><span class="pkg-link" data-pkg="lgr" data-topic="Filterable" data-id="set_filters"><a href="../../lgr/html/Filterable.html#method-Filterable-set_filters"><code>lgr::Filterable$set_filters()</code></a></span></li>
<li><span class="pkg-link" data-pkg="lgr" data-topic="Appender" data-id="format"><a href="../../lgr/html/Appender.html#method-Appender-format"><code>lgr::Appender$format()</code></a></span></li>
<li><span class="pkg-link" data-pkg="lgr" data-topic="Appender" data-id="set_threshold"><a href="../../lgr/html/Appender.html#method-Appender-set_threshold"><code>lgr::Appender$set_threshold()</code></a></span></li>
</ul></details></p><hr><a id="method-AppenderDt-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Creating a new AppenderDt</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/AppenderDt.html">AppenderDt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  threshold <span class="op">=</span> <span class="cn">NA_integer_</span>,</span>
<span>  layout <span class="op">=</span> <span class="va">LayoutFormat</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%L [%t] %m %f"</span>, timestamp_fmt <span class="op">=</span> <span class="st">"%H:%M:%OS3"</span>,</span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"lgr.colors"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prototype <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="cn">NA_integer_</span>, level <span class="op">=</span> <span class="cn">NA_integer_</span>, timestamp <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, logger <span class="op">=</span> <span class="cn">NA_character_</span>, caller <span class="op">=</span> <span class="cn">NA_character_</span>, msg <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>    .fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  filters <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>prototype</code></dt>
<dd><p>A prototype <code>data.table</code>. The prototype must be a
<code>data.table</code> with the same columns and column types as the data
you want to log. The actual content of the columns is irrelevant.
There are a few reserved column names that have special meaning:
* <code>.id</code>: <code>integer</code> (mandatory). Must always be the first column
and is used internally by the Appender
* <code>.fields</code>: <code>list</code> (optional). If present all custom values of the
event (that are not already part of the prototype) are stored in
this list column.</p></dd>


<dt><code>buffer_size</code></dt>
<dd><p><code>integer</code> scalar. Number of rows of the in-memory <code>data.table</code></p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-AppenderDt-append"></a><div class="section">
<h3 id="method-append-">Method <code><a href="https://rdrr.io/r/base/append.html" class="external-link">append()</a></code><a class="anchor" aria-label="anchor" href="#method-append-"></a></h3>

<div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppenderDt</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span><span class="va">event</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppenderDt-show"></a><div class="section">
<h3 id="method-show-">Method <code>show()</code><a class="anchor" aria-label="anchor" href="#method-show-"></a></h3>

<div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppenderDt</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span>threshold <span class="op">=</span> <span class="cn">NA_integer_</span>, n <span class="op">=</span> <span class="fl">20L</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppenderDt-set_layout"></a><div class="section">
<h3 id="method-set-layout-">Method <code>set_layout()</code><a class="anchor" aria-label="anchor" href="#method-set-layout-"></a></h3>

<div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppenderDt</span><span class="op">$</span><span class="fu">set_layout</span><span class="op">(</span><span class="va">layout</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div>

    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">lg</span> <span class="op">&lt;-</span> <span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html" class="external-link">get_logger</a></span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="fu">config</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  appenders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>memory <span class="op">=</span> <span class="va">AppenderDt</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  threshold <span class="op">=</span> <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>  propagate <span class="op">=</span> <span class="cn">FALSE</span>  <span class="co"># to prevent routing to root logger for this example</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;Logger&gt; [all] test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> appenders:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   memory: &lt;AppenderDt&gt; [all] -&gt; in memory data.table</span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="fu">debug</span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="fu">error</span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Displaying the log</span></span></span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="va">appenders</span><span class="op">$</span><span class="va">memory</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .id level           timestamp logger caller  msg .fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1   500 2023-01-02 09:01:33   test   eval test    NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   2   200 2023-01-02 09:01:33   test   eval test    NULL</span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="va">appenders</span><span class="op">$</span><span class="va">memory</span><span class="op">$</span><span class="fu">show</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DEBUG [09:01:33.143] test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ERROR [09:01:33.189] test</span>
<span class="r-in"><span><span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/simple_logging.html" class="external-link">show_log</a></span><span class="op">(</span>target <span class="op">=</span> <span class="va">lg</span><span class="op">$</span><span class="va">appenders</span><span class="op">$</span><span class="va">memory</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DEBUG [09:01:33.143] test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ERROR [09:01:33.189] test</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you pass a Logger to show_log(), it looks for the first AppenderDt</span></span></span>
<span class="r-in"><span><span class="co"># that it can find.</span></span></span>
<span class="r-in"><span><span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/simple_logging.html" class="external-link">show_log</a></span><span class="op">(</span>target <span class="op">=</span> <span class="va">lg</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DEBUG [09:01:33.143] test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ERROR [09:01:33.189] test</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom fields are stored in the list column .fields by default</span></span></span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"the iris data frame"</span>, caps <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="va">appenders</span><span class="op">$</span><span class="va">memory</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .id level           timestamp logger caller                 msg       .fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1   500 2023-01-02 09:01:33   test   eval                test          NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   2   200 2023-01-02 09:01:33   test   eval                test          NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   3   400 2023-01-02 09:01:33   test   eval the iris data frame A, B, C, D, E</span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="va">appenders</span><span class="op">$</span><span class="va">memory</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">.fields</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">caps</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "A" "B" "C" "D" "E"</span>
<span class="r-in"><span><span class="va">lg</span><span class="op">$</span><span class="fu">config</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;Logger&gt; [info] test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inherited appenders:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   console: &lt;AppenderConsole&gt; [all] -&gt; console</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stefan Fleck.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

